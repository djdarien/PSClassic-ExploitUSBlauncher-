#!/bin/sh
#  Cleaned up scripted for ps classic PCSX menu only and usb game loader (   gpghax / lolhack script to enable debug menu access)
#   Insert USB stick once the system has booted to the menu. The interface will restart.
#   Press Select + Triangle in-game to access the PCSX menu


#notifying user of start of script
echo 0 > /sys/class/leds/green/brightness
echo 1 > /sys/class/leds/red/brightness

#wait for amazing PS1 intro to finish :)
sleep 8s

#   Set the PCSX_ESC_KEY environment variable
export PCSX_ESC_KEY=2

#Kill main menu...just in case...
killall ui_menu

#2 controllers  with usb hub
mount -o bind /media/20-joystick.rules /etc/udev/rules.d/20-joystick.rules
udevadm control --reload-rules
udevadm trigger

#wait for 1sec and sync controller mount
sleep 1s
sync

#remove bilinear filtering
PATCH_DIR=/tmp/mipmap_patch
PATCH_TARGET=/usr/sony/bin/pcsx
PATCH_WORKING="${PATCH_DIR}/pcsx"
@ -21,9 +14,19 @@ cp "${PATCH_TARGET}" "${PATCH_WORKING}"
echo -n -e '\x00' | dd bs=1 of="${PATCH_WORKING}" seek=604669 count=1 conv=notrunc
mount -o bind "${PATCH_WORKING}" "${PATCH_TARGET}"

#Sync the usb
echo 0 > /sys/class/leds/red/brightness
sync
echo 1 > /sys/class/leds/green/brightness

#Allows access to Esc Menu from Select + Triangle
sleep 2s
cd /data/AppData/sony/pcsx
/usr/sony/bin/ui_menu --power-off-enable
@ -35,3 +38,4 @@ sync
sync

echo 1 > /sys/class/leds/green/brightness


# sleep forever so the usb is never unmounted and Esc Menu works
while :; do sleep 10; done
