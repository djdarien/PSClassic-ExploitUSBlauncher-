#!/bin/sh
#  Cleaned up scripted for ps classic PCSX menu only and usb game loader (   gpghax / lolhack script to enable debug menu access)
#   Insert USB stick once the system has booted to the menu. The interface will restart.
#   Press Select + Triangle in-game to access the PCSX menu
killall -s KILL sonyapp showLogo ui_menu
sleep 2s
PATCH_DIR=/tmp/mipmap_patch
PATCH_TARGET=/usr/sony/bin/pcsx
PATCH_WORKING="${PATCH_DIR}/pcsx"

# Perform patching
mkdir -p "${PATCH_DIR}"
cp "${PATCH_TARGET}" "${PATCH_WORKING}"
echo -n -e '\x00' | dd bs=1 of="${PATCH_WORKING}" seek=604669 count=1 conv=notrunc
mount -o bind "${PATCH_WORKING}" "${PATCH_TARGET}"

sync



#   Set the PCSX_ESC_KEY environment variable
sleep 3s
export PCSX_ESC_KEY=2

sync


#   Restart the Main Menu so changes are dected and ensuring Sony boot logo is smooth to be shown

sleep 6s
cd /data/AppData/sony/pcsx 
/usr/sony/bin/ui_menu --power-off-enable



#  Sync to console
sync


red_led "12" "0.3"
reboot